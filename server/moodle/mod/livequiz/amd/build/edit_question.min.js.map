{"version":3,"file":"edit_question.min.js","sources":["../src/edit_question.js"],"sourcesContent":["import Templates from \"core/templates\";\r\nimport { exception as displayException } from \"core/notification\";\r\nimport { save_question, get_question} from \"./repository\";\r\nimport {\r\n    add_answer_button_event_listener,\r\n    create_answer_container,\r\n    add_discard_question_button_listener,\r\n    validate_submission} from \"./edit_question_helper\";\r\nimport {add_delete_question_listeners} from \"./delete_question\";\r\n\r\nexport const init = async (quizid, lecturerid) => {\r\n    add_edit_question_listeners(quizid, lecturerid);\r\n};\r\n\r\nexport function add_edit_question_listeners(quizid, lecturerid) {\r\n    let question_list = document.getElementById(\"saved_questions_list\");\r\n    question_list.addEventListener(\"click\", (event) => {\r\n        let target = event.target;\r\n        if(target.classList.contains(\"edit-question-btn\") || target.classList.contains(\"question-title\")) {\r\n            let questionid = parseInt(target.dataset.id, 10);\r\n            render_edit_question_menu_popup(quizid, lecturerid, questionid);\r\n        }\r\n    });\r\n}\r\n\r\nfunction render_edit_question_menu_popup(quizid, lecturerid, questionid) {\r\n\r\nif(!document.querySelector('.Modal_div')){\r\n    // This will call the function to load and render our template.\r\n    Templates.renderForPromise(\"mod_livequiz/question_menu_popup\")\r\n\r\n        // It returns a promise that needs to be resolved.\r\n        .then(({ html, js }) => {\r\n            // Here we have the compiled template.\r\n            Templates.appendNodeContents(\".main-container\", html, js);\r\n            get_question(quizid, questionid).then((question)=> {restore_question_data_in_popup(question);});\r\n            add_answer_button_event_listener();\r\n            add_save_question_button_listener(quizid, lecturerid, questionid);\r\n            add_discard_question_button_listener();\r\n        })\r\n\r\n      // Deal with this exception (Using core/notify exception function is recommended).\r\n      .catch((error) => displayException(error));\r\n  }\r\n}\r\n\r\nfunction add_save_question_button_listener(quizid, lecturerid, questionid) {\r\n    let save_question_button = document.querySelector(\".save_button\");\r\n    save_question_button.addEventListener(\"click\", () => {\r\n        on_save_question_button_clicked(quizid, lecturerid, questionid);\r\n    });\r\n}\r\n\r\nfunction on_save_question_button_clicked(quizid, lecturerid, questionid) {\r\n    let question_input_title = document.getElementById(\"question_title_id\");\r\n    let question_indput_description = document.getElementById(\"question_description_id\");\r\n    let question_indput_explanation = document.getElementById(\"question_explanation_id\");\r\n    let questionTitle = question_input_title.value.trim();\r\n    let questionDescription = question_indput_description.value.trim();\r\n    let questionExplanation = question_indput_explanation.value.trim();\r\n    let questionType = document.getElementById(\"question_type_checkbox_id\").checked ? 1 : 0;\r\n\r\n    let answers = [];\r\n    let answers_div = document.querySelector(\".all_answers_for_question_div\");\r\n    for (let i = 0; i < answers_div.children.length; i++) {\r\n        let answertext = answers_div.children[i]\r\n            .querySelector(\".answer_input\")\r\n            .value.trim();\r\n\r\n        let iscorrect =\r\n            answers_div.children[i].querySelector(\".answer_checkbox\").checked;\r\n        iscorrect = iscorrect ? 1 : 0;\r\n\r\n        answers.push({\r\n            description: answertext,\r\n            correct: iscorrect,\r\n            explanation: \"\",\r\n        });\r\n    }\r\n\r\n    let savedQuestion = {\r\n        id: questionid,\r\n        title: questionTitle,\r\n        answers: answers,\r\n        description: questionDescription,\r\n        explanation: questionExplanation,\r\n        type: questionType,\r\n    };\r\n\r\n    if(!validate_submission(savedQuestion.answers)) {\r\n        return;\r\n    }\r\n\r\n    save_question(savedQuestion, lecturerid, quizid)\r\n        .then((questions) => {\r\n        const contextsavedquestions = {\r\n            questions: questions,\r\n        };\r\n\r\n        //Remove the saved questions list.\r\n        let questions_list = document.querySelector(\"#saved_questions_list\");\r\n        questions_list.remove();\r\n\r\n        //Re-render saved questions list.\r\n        Templates.renderForPromise(\r\n            \"mod_livequiz/saved_questions_list\",\r\n            contextsavedquestions\r\n        )\r\n            .then(({ html, js }) => {\r\n                Templates.appendNodeContents(\"#saved-questions-container\", html, js);\r\n                add_edit_question_listeners(quizid, lecturerid);\r\n                add_delete_question_listeners(quizid,lecturerid);\r\n            })\r\n            .catch((error) => displayException(error));\r\n    }).catch(() => alert(\"Cannot edit a question with particpations\"));\r\n    //Remove edit question pop-up\r\n    let modal_div = document.querySelector(\".Modal_div\");\r\n    modal_div.remove();\r\n}\r\nfunction restore_question_data_in_popup(questiondata){\r\n    document.getElementById(\"question_title_id\").value = questiondata.questiontitle;\r\n    document.getElementById(\"question_description_id\").value = questiondata.questiondescription;\r\n    document.getElementById(\"question_explanation_id\").value = questiondata.questionexplanation;\r\n    document.getElementById(\"question_type_checkbox_id\").checked = questiondata.questiontype === 'radio';\r\n    let answers = questiondata.answers;\r\n    for(let i=0; i < answers.length; i++){\r\n        restore_answer_data_in_popup(answers[i]);\r\n    }\r\n}\r\n\r\nfunction restore_answer_data_in_popup(answer) {\r\n    let answer_container = create_answer_container(answer.answerid);\r\n    answer_container.querySelector(\".answer_input\").value = answer.answerdescription;\r\n    answer_container.querySelector(\".answer_checkbox\").checked = answer.answercorrect;\r\n    let parent_element = document.querySelector(\".all_answers_for_question_div\");\r\n    parent_element.appendChild(answer_container);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["add_edit_question_listeners","quizid","lecturerid","document","getElementById","addEventListener","event","target","classList","contains","questionid","parseInt","dataset","id","querySelector","renderForPromise","then","_ref","html","js","appendNodeContents","question","questiondata","value","questiontitle","questiondescription","questionexplanation","checked","questiontype","answers","i","length","restore_answer_data_in_popup","restore_question_data_in_popup","question_input_title","question_indput_description","question_indput_explanation","questionTitle","trim","questionDescription","questionExplanation","questionType","answers_div","children","answertext","iscorrect","push","description","correct","explanation","savedQuestion","title","type","questions","contextsavedquestions","remove","_ref2","catch","error","alert","on_save_question_button_clicked","add_save_question_button_listener","render_edit_question_menu_popup","answer","answer_container","answerid","answerdescription","answercorrect","appendChild","async"],"mappings":"8cAcgBA,4BAA4BC,OAAQC,YAC5BC,SAASC,eAAe,wBAC9BC,iBAAiB,SAAUC,YACjCC,OAASD,MAAMC,UAChBA,OAAOC,UAAUC,SAAS,sBAAwBF,OAAOC,UAAUC,SAAS,kBAAmB,KAC1FC,WAAaC,SAASJ,OAAOK,QAAQC,GAAI,cAMhBZ,OAAQC,WAAYQ,YAEzDP,SAASW,cAAc,kCAEbC,iBAAiB,oCAGtBC,MAAKC,WAACC,KAAEA,KAAFC,GAAQA,4BAEDC,mBAAmB,kBAAmBF,KAAMC,iCACzClB,OAAQS,YAAYM,MAAMK,qBAoFXC,cACpCnB,SAASC,eAAe,qBAAqBmB,MAAQD,aAAaE,cAClErB,SAASC,eAAe,2BAA2BmB,MAAQD,aAAaG,oBACxEtB,SAASC,eAAe,2BAA2BmB,MAAQD,aAAaI,oBACxEvB,SAASC,eAAe,6BAA6BuB,QAAwC,UAA9BL,aAAaM,iBACxEC,QAAUP,aAAaO,YACvB,IAAIC,EAAE,EAAGA,EAAID,QAAQE,OAAQD,IAC7BE,6BAA6BH,QAAQC,IA3FmBG,CAA+BZ,mFAWpDpB,OAAQC,WAAYQ,YAChCP,SAASW,cAAc,gBAC7BT,iBAAiB,SAAS,eAKVJ,OAAQC,WAAYQ,gBACrDwB,qBAAuB/B,SAASC,eAAe,qBAC/C+B,4BAA8BhC,SAASC,eAAe,2BACtDgC,4BAA8BjC,SAASC,eAAe,2BACtDiC,cAAgBH,qBAAqBX,MAAMe,OAC3CC,oBAAsBJ,4BAA4BZ,MAAMe,OACxDE,oBAAsBJ,4BAA4Bb,MAAMe,OACxDG,aAAetC,SAASC,eAAe,6BAA6BuB,QAAU,EAAI,EAElFE,QAAU,GACVa,YAAcvC,SAASW,cAAc,qCACpC,IAAIgB,EAAI,EAAGA,EAAIY,YAAYC,SAASZ,OAAQD,IAAK,KAC9Cc,WAAaF,YAAYC,SAASb,GACjChB,cAAc,iBACdS,MAAMe,OAEPO,UACAH,YAAYC,SAASb,GAAGhB,cAAc,oBAAoBa,QAC9DkB,UAAYA,UAAY,EAAI,EAE5BhB,QAAQiB,KAAK,CACTC,YAAaH,WACbI,QAASH,UACTI,YAAa,SAIjBC,cAAgB,CAChBrC,GAAIH,WACJyC,MAAOd,cACPR,QAASA,QACTkB,YAAaR,oBACbU,YAAaT,oBACbY,KAAMX,mBAGN,6CAAoBS,cAAcrB,8CAIxBqB,cAAehD,WAAYD,QACpCe,MAAMqC,kBACDC,sBAAwB,CAC1BD,UAAWA,WAIMlD,SAASW,cAAc,yBAC7ByC,4BAGLxC,iBACN,oCACAuC,uBAECtC,MAAKwC,YAACtC,KAAEA,KAAFC,GAAQA,6BACDC,mBAAmB,6BAA8BF,KAAMC,IACjEnB,4BAA4BC,OAAQC,+DACND,OAAOC,eAExCuD,OAAOC,QAAU,2BAAiBA,YACxCD,OAAM,IAAME,MAAM,+CAELxD,SAASW,cAAc,cAC7ByC,SApENK,CAAgC3D,OAAQC,WAAYQ,eAZhDmD,CAAkC5D,OAAQC,WAAYQ,gFAK3D+C,OAAOC,QAAU,2BAAiBA,SAtB7BI,CAAgC7D,OAAQC,WAAYQ,yBA8GvDsB,6BAA6B+B,YAC9BC,kBAAmB,iDAAwBD,OAAOE,UACtDD,iBAAiBlD,cAAc,iBAAiBS,MAAQwC,OAAOG,kBAC/DF,iBAAiBlD,cAAc,oBAAoBa,QAAUoC,OAAOI,cAC/ChE,SAASW,cAAc,iCAC7BsD,YAAYJ,gCA7HXK,MAAOpE,OAAQC,cAC/BF,4BAA4BC,OAAQC"}