{"version":3,"file":"edit_question.min.js","sources":["../src/edit_question.js"],"sourcesContent":["import Templates from \"core/templates\";\r\nimport {saveQuestion, getQuestion} from \"./repository\";\r\nimport {\r\n    addAnswerButtonEventListener,\r\n    createAnswerContainer,\r\n    addCancelEditButtonListener,\r\n    validateSubmission,\r\n    getQuestionData, prepareAnswers,\r\n} from \"./helper\";\r\nimport {addDeleteQuestionListeners} from \"./delete_question\";\r\n\r\n/**\r\n * Adds event listeners for when the questions in the list of saved questions are clicked.\r\n *\r\n * @param {int} quizId\r\n * @param {int} lecturerId\r\n * @returns {Promise<void>}\r\n */\r\nexport const init = async(quizId, lecturerId) => {\r\n    addEditQuestionListeners(quizId, lecturerId);\r\n};\r\n\r\n/**\r\n * Helper function for adding click-event listeners on the saved questions.\r\n *\r\n * @param {int} quizId\r\n * @param {int} lecturerId\r\n * @returns {void}\r\n */\r\nexport function addEditQuestionListeners(quizId, lecturerId) {\r\n    let questionList = document.getElementById(\"saved_questions_list\");\r\n    questionList.addEventListener(\"click\", (event) => {\r\n        let target = event.target;\r\n        if (target.classList.contains(\"edit-question-btn\") || target.classList.contains(\"question_list_text\")) {\r\n            let questionId = parseInt(target.dataset.id, 10);\r\n            renderEditQuestionMenuPopup(quizId, lecturerId, questionId);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Render the pop-up for editing a given question.\r\n *\r\n * @param {int} quizId\r\n * @param {int} lecturerId\r\n * @param {int} questionId\r\n * @returns {void}\r\n */\r\nfunction renderEditQuestionMenuPopup(quizId, lecturerId, questionId) {\r\n\r\nif(!document.querySelector('.modal_div')){\r\n    // This will call the function to load and render our template.\r\n    Templates.renderForPromise(\"mod_livequiz/question_menu_popup\", {}, \"boost\")\r\n\r\n        // It returns a promise that needs to be resolved.\r\n        .then(({html, js}) => {\r\n            // Here we have the compiled template.\r\n            Templates.appendNodeContents(\".main_container\", html, js);\r\n            getQuestion(quizId, questionId)\r\n                .then((question)=> {\r\n                    restoreQuestionDataInPopup(question);\r\n                })\r\n                .catch((error) => window.console.log(error));\r\n            addAnswerButtonEventListener();\r\n            addSaveQuestionButtonListener(quizId, lecturerId, questionId);\r\n            addCancelEditButtonListener(\"edit\");\r\n        })\r\n      .catch((error) => window.console.log(error)); // Deal with this exception (Using core/notify exception function is recommended).\r\n  }\r\n}\r\n\r\n/**\r\n * Adds an event listener to the save question button.\r\n *\r\n * @param {int} quizId\r\n * @param {int} lecturerId\r\n * @param {int} questionId\r\n * @returns {void}\r\n */\r\nfunction addSaveQuestionButtonListener(quizId, lecturerId, questionId) {\r\n    let saveQuestionButton = document.querySelector(\".save_button\");\r\n    saveQuestionButton.addEventListener(\"click\", () => {\r\n        handleSaveQuestion(quizId, lecturerId, questionId);\r\n    });\r\n}\r\n\r\n/**\r\n * Event handler for when a question is saved.\r\n *\r\n * @param {int} quizId\r\n * @param {int} lecturerId\r\n * @param {int} questionId\r\n * @returns {void}\r\n */\r\nfunction handleSaveQuestion(quizId, lecturerId, questionId) {\r\n    let questionData = getQuestionData();\r\n    let savedQuestion = {\r\n        id: questionId,\r\n        title: questionData.title,\r\n        answers: prepareAnswers(),\r\n        description: questionData.description,\r\n        explanation: questionData.explanation,\r\n        type: questionData.type,\r\n    };\r\n\r\n    if (!validateSubmission(savedQuestion.answers)) {\r\n        return;\r\n    }\r\n\r\n    saveQuestion(savedQuestion, lecturerId, quizId).then((questions) => {\r\n        const contextsavedquestions = {\r\n            questions: questions,\r\n        };\r\n\r\n        // Remove the saved questions list.\r\n        let questionsList = document.querySelector(\"#saved_questions_list\");\r\n        questionsList.remove();\r\n\r\n        // Re-render saved questions list.\r\n        Templates.renderForPromise(\r\n            \"mod_livequiz/saved_questions_list\",\r\n            contextsavedquestions,\r\n            \"boost\"\r\n        )\r\n            .then(({html, js}) => {\r\n                Templates.appendNodeContents(\"#saved_questions_container\", html, js);\r\n                addEditQuestionListeners(quizId, lecturerId);\r\n                addDeleteQuestionListeners(quizId, lecturerId);\r\n            })\r\n            .catch((error) => displayException(error));\r\n    }).catch(() => alert(\"Cannot edit a question, since it already has participations\"));\r\n    //Remove edit question pop-up\r\n    let modalDiv = document.querySelector(\".backdrop\");\r\n    modalDiv.remove();\r\n}\r\n\r\n/**\r\n * The data for the question passed as argument is rendered in the edit-question pop-up.\r\n *\r\n * @param {Object} questionData\r\n * @returns {void}\r\n */\r\nfunction restoreQuestionDataInPopup(questionData) {\r\n    document.getElementById(\"question_title_id\").value = questionData.questiontitle;\r\n    document.getElementById(\"question_description_id\").value = questionData.questiondescription;\r\n    document.getElementById(\"question_explanation_id\").value = questionData.questionexplanation;\r\n    document.getElementById(\"question_type_checkbox_id\").checked = questionData.questiontype === 'radio';\r\n    let answers = questionData.answers;\r\n    for (let i = 0; i < answers.length; i++) {\r\n        restoreAnswerDataInPopup(answers[i]);\r\n    }\r\n}\r\n\r\n/**\r\n * The data for the answer passed as argument is rendered in the edit-question pop-up.\r\n *\r\n * @param {Object} answer\r\n * @returns {void}\r\n */\r\nfunction restoreAnswerDataInPopup(answer) {\r\n    let answerContainer = createAnswerContainer(answer.answerid);\r\n    answerContainer.querySelector(\".answer_input\").value = answer.answerdescription;\r\n    answerContainer.querySelector(\".answer_checkbox\").checked = answer.answercorrect;\r\n    let parentElement = document.querySelector(\".all_answers_for_question_div\");\r\n    parentElement.appendChild(answerContainer);\r\n}\r\n"],"names":["addEditQuestionListeners","quizId","lecturerId","document","getElementById","addEventListener","event","target","classList","contains","questionId","parseInt","dataset","id","querySelector","renderForPromise","then","_ref","html","js","appendNodeContents","question","questionData","value","questiontitle","questiondescription","questionexplanation","checked","questiontype","answers","i","length","restoreAnswerDataInPopup","restoreQuestionDataInPopup","catch","error","window","console","log","savedQuestion","title","description","explanation","type","questions","contextsavedquestions","remove","_ref2","displayException","alert","handleSaveQuestion","addSaveQuestionButtonListener","renderEditQuestionMenuPopup","answer","answerContainer","answerid","answerdescription","answercorrect","appendChild","async"],"mappings":"0YA6BgBA,yBAAyBC,OAAQC,YAC1BC,SAASC,eAAe,wBAC9BC,iBAAiB,SAAUC,YAChCC,OAASD,MAAMC,UACfA,OAAOC,UAAUC,SAAS,sBAAwBF,OAAOC,UAAUC,SAAS,sBAAuB,KAC/FC,WAAaC,SAASJ,OAAOK,QAAQC,GAAI,cAcpBZ,OAAQC,WAAYQ,YAErDP,SAASW,cAAc,kCAEbC,iBAAiB,mCAAoC,GAAI,SAG9DC,MAAKC,WAACC,KAACA,KAADC,GAAOA,4BAEAC,mBAAmB,kBAAmBF,KAAMC,gCAC1ClB,OAAQS,YACfM,MAAMK,qBAmFaC,cAChCnB,SAASC,eAAe,qBAAqBmB,MAAQD,aAAaE,cAClErB,SAASC,eAAe,2BAA2BmB,MAAQD,aAAaG,oBACxEtB,SAASC,eAAe,2BAA2BmB,MAAQD,aAAaI,oBACxEvB,SAASC,eAAe,6BAA6BuB,QAAwC,UAA9BL,aAAaM,iBACxEC,QAAUP,aAAaO,YACtB,IAAIC,EAAI,EAAGA,EAAID,QAAQE,OAAQD,IAChCE,yBAAyBH,QAAQC,IAzFrBG,CAA2BZ,aAE9Ba,OAAOC,OAAUC,OAAOC,QAAQC,IAAIH,6DAiBdlC,OAAQC,WAAYQ,YAC9BP,SAASW,cAAc,gBAC7BT,iBAAiB,SAAS,eAarBJ,OAAQC,WAAYQ,gBACxCY,cAAe,6BACfiB,cAAgB,CAChB1B,GAAIH,WACJ8B,MAAOlB,aAAakB,MACpBX,SAAS,4BACTY,YAAanB,aAAamB,YAC1BC,YAAapB,aAAaoB,YAC1BC,KAAMrB,aAAaqB,WAGlB,8BAAmBJ,cAAcV,6CAIzBU,cAAerC,WAAYD,QAAQe,MAAM4B,kBAC5CC,sBAAwB,CAC1BD,UAAWA,WAIKzC,SAASW,cAAc,yBAC7BgC,4BAGJ/B,iBACN,oCACA8B,sBACA,SAEC7B,MAAK+B,YAAC7B,KAACA,KAADC,GAAOA,6BACAC,mBAAmB,6BAA8BF,KAAMC,IACjEnB,yBAAyBC,OAAQC,4DACND,OAAQC,eAEtCgC,OAAOC,OAAUa,iBAAiBb,YACxCD,OAAM,IAAMe,MAAM,iEAEN9C,SAASW,cAAc,aAC7BgC,SAnDLI,CAAmBjD,OAAQC,WAAYQ,eAlBnCyC,CAA8BlD,OAAQC,WAAYQ,oDACtB,WAEjCwB,OAAOC,OAAUC,OAAOC,QAAQC,IAAIH,SAhC/BiB,CAA4BnD,OAAQC,WAAYQ,yBA4HnDsB,yBAAyBqB,YAC1BC,iBAAkB,iCAAsBD,OAAOE,UACnDD,gBAAgBxC,cAAc,iBAAiBS,MAAQ8B,OAAOG,kBAC9DF,gBAAgBxC,cAAc,oBAAoBa,QAAU0B,OAAOI,cAC/CtD,SAASW,cAAc,iCAC7B4C,YAAYJ,+BAlJVK,MAAM1D,OAAQC,cAC9BF,yBAAyBC,OAAQC"}