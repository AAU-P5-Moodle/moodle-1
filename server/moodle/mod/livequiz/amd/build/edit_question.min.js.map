{"version":3,"file":"edit_question.min.js","sources":["../src/edit_question.js"],"sourcesContent":["import Templates from \"core/templates\";\r\nimport { exception as displayException } from \"core/notification\";\r\nimport { save_question, get_question } from \"./repository\";\r\nimport {\r\n  add_answer_button_event_listener,\r\n  create_answer_container,\r\n  add_discard_question_button_listener,\r\n} from \"./helper\";\r\nimport { rerender_saved_questions_list } from \"./helper\";\r\nimport { add_delete_question_listeners } from \"./delete_question\";\r\n\r\nexport const init = async (quizid, lecturerid) => {\r\n  add_edit_question_listeners(quizid, lecturerid);\r\n};\r\n\r\nexport function add_edit_question_listeners(quizid, lecturerid) {\r\n  let question_list = document.getElementById(\"saved_questions_list\");\r\n  let edit_question_elements = question_list.querySelectorAll(\".edit-question\");\r\n  edit_question_elements.forEach((element) => {\r\n    let questionid = parseInt(element.dataset.id, 10);\r\n    element.addEventListener(\"click\", () => {\r\n      render_edit_question_menu_popup(quizid, lecturerid, questionid);\r\n    });\r\n  });\r\n}\r\n\r\nfunction render_edit_question_menu_popup(quizid, lecturerid, questionid) {\r\n\r\nif(!document.querySelector('.Modal_div')){\r\n    // This will call the function to load and render our template.\r\n    Templates.renderForPromise(\"mod_livequiz/question_menu_popup\")\r\n\r\n      // It returns a promise that needs to be resolved.\r\n      .then(({ html, js }) => {\r\n        // Here we have the compiled template.\r\n        Templates.appendNodeContents(\".main-container\", html, js);\r\n        get_question(quizid, questionid).then((question) => {\r\n          restore_question_data_in_popup(question);\r\n        });\r\n        add_answer_button_event_listener();\r\n        add_save_question_button_listener(quizid, lecturerid, questionid);\r\n        add_discard_question_button_listener();\r\n      })\r\n\r\n      // Deal with this exception (Using core/notify exception function is recommended).\r\n      .catch((error) => displayException(error));\r\n  }\r\n}\r\n\r\nfunction add_save_question_button_listener(quizid, lecturerid, questionid) {\r\n  let save_question_button = document.querySelector(\".save_button\");\r\n  save_question_button.addEventListener(\"click\", () => {\r\n    on_save_question_button_clicked(quizid, lecturerid, questionid);\r\n  });\r\n}\r\n\r\nfunction on_save_question_button_clicked(quizid, lecturerid, questionid) {\r\n  let question_input_title = document.getElementById(\"question_title_id\");\r\n  let question_indput_description = document.getElementById(\r\n    \"question_description_id\"\r\n  );\r\n  let question_indput_explanation = document.getElementById(\r\n    \"question_explanation_id\"\r\n  );\r\n  let questionTitle = question_input_title.value.trim();\r\n  let questionDesription = question_indput_description.value.trim();\r\n  let questionExplanation = question_indput_explanation.value.trim();\r\n\r\n  if (!questionDesription) {\r\n    alert(\"Please enter a question description.\");\r\n    return;\r\n  }\r\n  if (!questionTitle) {\r\n    questionTitle = \"Question\";\r\n  }\r\n  let answers = [];\r\n  let answers_div = document.querySelector(\".all_answers_for_question_div\");\r\n  for (let i = 0; i < answers_div.children.length; i++) {\r\n    let answertext = answers_div.children[i]\r\n      .querySelector(\".answer_input\")\r\n      .value.trim();\r\n\r\n    let iscorrect =\r\n      answers_div.children[i].querySelector(\".answer_checkbox\").checked;\r\n    iscorrect ? (iscorrect = 1) : (iscorrect = 0);\r\n\r\n    answers.push({\r\n      description: answertext,\r\n      correct: iscorrect,\r\n      explanation: \"\",\r\n    });\r\n  }\r\n\r\n  let savedQuestion = {\r\n    id: questionid,\r\n    title: questionTitle,\r\n    answers: answers,\r\n    description: questionDesription,\r\n    explanation: questionExplanation,\r\n  };\r\n  \r\n  //Specify the element we want to add event listeners to after saving questions\r\n  let update_event_listeners = () => {\r\n    add_edit_question_listeners(quizid, lecturerid);\r\n    add_delete_question_listeners(quizid, lecturerid);\r\n  }\r\n\r\n  //Save question in DB, and rerender question list on front-end.\r\n  save_question(savedQuestion, lecturerid, quizid).then((questions) => {rerender_saved_questions_list(questions, update_event_listeners)});\r\n  \r\n  //Remove edit question pop-up\r\n  let modal_div = document.querySelector(\".Modal_div\");\r\n  modal_div.remove();\r\n\r\n}\r\nfunction restore_question_data_in_popup(questiondata) {\r\n  document.getElementById(\"question_title_id\").value =\r\n    questiondata.questiontitle;\r\n  document.getElementById(\"question_description_id\").value =\r\n    questiondata.questiondescription;\r\n  document.getElementById(\"question_explanation_id\").value =\r\n    questiondata.questionexplanation;\r\n  let answers = questiondata.answers;\r\n  for (let i = 0; i < answers.length; i++) {\r\n    restore_answer_data_in_popup(answers[i]);\r\n  }\r\n  console.log(\"answers: \", answers);\r\n}\r\n\r\nfunction restore_answer_data_in_popup(answer) {\r\n  let answer_container = create_answer_container(answer.answerid);\r\n  answer_container.querySelector(\".answer_input\").value =\r\n    answer.answerdescription;\r\n  answer_container.querySelector(\".answer_checkbox\").checked =\r\n    answer.answercorrect;\r\n  let parent_element = document.querySelector(\".all_answers_for_question_div\");\r\n  parent_element.appendChild(answer_container);\r\n}\r\n"],"names":["add_edit_question_listeners","quizid","lecturerid","document","getElementById","querySelectorAll","forEach","element","questionid","parseInt","dataset","id","addEventListener","querySelector","renderForPromise","then","_ref","html","js","appendNodeContents","question","questiondata","value","questiontitle","questiondescription","questionexplanation","answers","i","length","restore_answer_data_in_popup","console","log","restore_question_data_in_popup","question_input_title","question_indput_description","question_indput_explanation","questionTitle","trim","questionDesription","questionExplanation","alert","answers_div","children","answertext","iscorrect","checked","push","description","correct","explanation","savedQuestion","title","update_event_listeners","questions","remove","on_save_question_button_clicked","add_save_question_button_listener","catch","error","render_edit_question_menu_popup","answer","answer_container","answerid","answerdescription","answercorrect","appendChild","async"],"mappings":"kbAegBA,4BAA4BC,OAAQC,YAC9BC,SAASC,eAAe,wBACDC,iBAAiB,kBACrCC,SAASC,cAC1BC,WAAaC,SAASF,QAAQG,QAAQC,GAAI,IAC9CJ,QAAQK,iBAAiB,SAAS,eAMGX,OAAQC,WAAYM,YAEzDL,SAASU,cAAc,kCAEbC,iBAAiB,oCAGxBC,MAAKC,WAACC,KAAEA,KAAFC,GAAQA,4BAEHC,mBAAmB,kBAAmBF,KAAMC,iCACzCjB,OAAQO,YAAYO,MAAMK,qBA+EPC,cACtClB,SAASC,eAAe,qBAAqBkB,MAC3CD,aAAaE,cACfpB,SAASC,eAAe,2BAA2BkB,MACjDD,aAAaG,oBACfrB,SAASC,eAAe,2BAA2BkB,MACjDD,aAAaI,wBACXC,QAAUL,aAAaK,YACtB,IAAIC,EAAI,EAAGA,EAAID,QAAQE,OAAQD,IAClCE,6BAA6BH,QAAQC,IAEvCG,QAAQC,IAAI,YAAaL,SAzFjBM,CAA+BZ,qEAYEnB,OAAQC,WAAYM,YAClCL,SAASU,cAAc,gBAC7BD,iBAAiB,SAAS,eAKRX,OAAQC,WAAYM,gBACvDyB,qBAAuB9B,SAASC,eAAe,qBAC/C8B,4BAA8B/B,SAASC,eACzC,2BAEE+B,4BAA8BhC,SAASC,eACzC,2BAEEgC,cAAgBH,qBAAqBX,MAAMe,OAC3CC,mBAAqBJ,4BAA4BZ,MAAMe,OACvDE,oBAAsBJ,4BAA4Bb,MAAMe,WAEvDC,+BACHE,MAAM,wCAGHJ,gBACHA,cAAgB,gBAEdV,QAAU,GACVe,YAActC,SAASU,cAAc,qCACpC,IAAIc,EAAI,EAAGA,EAAIc,YAAYC,SAASd,OAAQD,IAAK,KAChDgB,WAAaF,YAAYC,SAASf,GACnCd,cAAc,iBACdS,MAAMe,OAELO,UACFH,YAAYC,SAASf,GAAGd,cAAc,oBAAoBgC,QAC/CD,UAAbA,UAAyB,EAAkB,EAE3ClB,QAAQoB,KAAK,CACXC,YAAaJ,WACbK,QAASJ,UACTK,YAAa,SAIbC,cAAgB,CAClBvC,GAAIH,WACJ2C,MAAOf,cACPV,QAASA,QACTqB,YAAaT,mBACbW,YAAaV,qBAIXa,uBAAyB,KAC3BpD,4BAA4BC,OAAQC,+DACND,OAAQC,2CAI1BgD,cAAehD,WAAYD,QAAQc,MAAMsC,sDAA6CA,UAAWD,2BAG/FjD,SAASU,cAAc,cAC7ByC,SA5DRC,CAAgCtD,OAAQC,WAAYM,eAZhDgD,CAAkCvD,OAAQC,WAAYM,kEAKvDiD,OAAOC,QAAU,2BAAiBA,SAxBnCC,CAAgC1D,OAAQC,WAAYM,2BA4GjDqB,6BAA6B+B,YAChCC,kBAAmB,mCAAwBD,OAAOE,UACtDD,iBAAiBhD,cAAc,iBAAiBS,MAC9CsC,OAAOG,kBACTF,iBAAiBhD,cAAc,oBAAoBgC,QACjDe,OAAOI,cACY7D,SAASU,cAAc,iCAC7BoD,YAAYJ,gCA7HTK,MAAOjE,OAAQC,cACjCF,4BAA4BC,OAAQC"}