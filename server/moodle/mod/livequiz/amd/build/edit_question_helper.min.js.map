{"version":3,"file":"edit_question_helper.min.js","sources":["../src/edit_question_helper.js"],"sourcesContent":["import Templates from \"core/templates\";\r\nimport { exception as displayException } from \"core/notification\";\r\n\r\nlet IDs = 0;\r\nlet isEditing = false;\r\nlet editingIndex = 0;\r\n\r\n/**\r\n * Adds an event listener to the \"Add Answer\" button.\r\n * When the button is clicked, it appends a new answer input field.\r\n */\r\nexport const add_answer_button_event_listener = () => {\r\n  //Adding event listerner to add answer button\r\n  let answer_button = document.querySelector(\".add_new_answer_to_question\");\r\n  answer_button.addEventListener(\"click\", () => {\r\n    append_answer_input();\r\n  });\r\n};\r\n\r\n/**\r\n * Appends a new answer input container to the container holding all answers\r\n *\r\n * This function creates a new answer container with an incremented ID and appends it to the\r\n * element with the class \"all_answers_for_question_div\".\r\n */\r\nexport function append_answer_input() {\r\n  let answer_container = create_answer_container(IDs + 1);\r\n  let parent_element = document.querySelector(\".all_answers_for_question_div\");\r\n  parent_element.appendChild(answer_container);\r\n  IDs++;\r\n}\r\n\r\n/**\r\n * Creates a new answer container element.\r\n * THIS SHOULD PROBABLY BE MADE INTO MUSTACHE TEMPLATE INSTEAD OF A FUNCTION\r\n *\r\n * @param {string} id - The unique identifier for the answer container.\r\n * @returns {HTMLDivElement} The created answer container element.\r\n */\r\nexport function create_answer_container(id) {\r\n  let answer_container = document.createElement(\"div\");\r\n  answer_container.className = \"container_for_new_answer\";\r\n\r\n  let answer_input = document.createElement(\"input\");\r\n  answer_input.className = \"answer_input\";\r\n  answer_input.placeholder = \"Enter answer\";\r\n  answer_input.id = \"answer_input_\" + id;\r\n  answer_input.setAttribute(\"required\", true);\r\n\r\n  let answer_checkbox = document.createElement(\"input\");\r\n  answer_checkbox.setAttribute(\"type\", \"checkbox\");\r\n  answer_checkbox.className = \"answer_checkbox\";\r\n  answer_checkbox.id = \"answer_checkbox_\" + id;\r\n\r\n  let delete_answer_button = create_element(\r\n    \"delete_answer_button\",\r\n    \"button\",\r\n    \"delete_answer_button\",\r\n    \"X\"\r\n  );\r\n  delete_answer_button.id = \"delete_answer_button_\" + id;\r\n\r\n  answer_container.appendChild(answer_checkbox);\r\n  answer_container.appendChild(answer_input);\r\n  answer_container.appendChild(delete_answer_button);\r\n\r\n  delete_answer_button.addEventListener(\"click\", () => {\r\n    answer_container.remove();\r\n  });\r\n  return answer_container;\r\n}\r\n\r\n/**\r\n * Creates a new HTML element with the specified type, class, and content.\r\n *\r\n * @param {HTMLElement} element_name - The variable to hold the created element.\r\n * @param {string} type - The type of the HTML element to create (e.g., 'div', 'span').\r\n * @param {string} class_name - The class name to assign to the created element.\r\n * @param {string} content - The text content to set for the created element.\r\n * @returns {HTMLElement} The newly created HTML element.\r\n */\r\nfunction create_element(element_name, type, class_name, content) {\r\n  element_name = document.createElement(type);\r\n  element_name.className = class_name;\r\n  element_name.textContent = content;\r\n  return element_name;\r\n}\r\n\r\n/**\r\n * Rerenders the saved questions list.\r\n *\r\n * This function removes the existing saved questions list from the DOM,\r\n * Renders the \"mod_livequiz/saved_questions_list\" template with the provided questions\r\n * After re-rendering, it calls the provided callback function, if any.\r\n *\r\n * @param {Array} questions - An array of question objects to be rendered.\r\n * @param {Function} [callback] - An optional callback function to be executed after the list is re-rendered.\r\n */\r\nexport function rerender_saved_questions_list(questions, callback) {\r\n  // The template needs to know the questions to render.\r\n  const contextsavedquestions = {\r\n    questions: questions,\r\n  };\r\n\r\n  // Remove the saved questions list.\r\n  let questions_list = document.querySelector(\"#saved_questions_list\");\r\n  questions_list.remove();\r\n\r\n  // Re-render saved questions list.\r\n  Templates.renderForPromise(\r\n    \"mod_livequiz/saved_questions_list\",\r\n    contextsavedquestions\r\n  )\r\n    .then(({ html, js }) => {\r\n      Templates.appendNodeContents(\"#saved_questions_container\", html, js);\r\n\r\n      // Call the functions in callback, this allows for custom functions to be called after the rerendering.\r\n      if (typeof callback === \"function\") {\r\n        callback();\r\n      }\r\n    })\r\n    .catch((error) => console.log(error));\r\n}\r\n\r\n/**\r\n * Renders the \"mod_livequiz/take_quiz_button\" template based on whether there are questions in the quiz.\r\n *\r\n * @param {string} url - The URL for the \"Take Quiz\" button to redirect to.\r\n * @param {boolean} hasquestions - Indicates if the quiz has questions.\r\n * @param {function} [callback] - Optional callback function to execute after re-rendering.\r\n */\r\n\r\nexport function rerender_take_quiz_button(url, hasquestions, callback) {\r\n  //The template needs to know if there are questions in the quiz.\r\n  //If there are questions -> Create a button to redirect to the quiz.\r\n  //If there are no questions -> Display a paragraph that says there are no questions.\r\n\r\n  const contexttakequiz = {\r\n    url: url,\r\n    hasquestions: hasquestions,\r\n  };\r\n\r\n  if (hasquestions) {\r\n    //Remove no question paragraph if there are questions.\r\n    let no_question_paragraph = document.querySelector(\".no_question_text\");\r\n    if (no_question_paragraph) {\r\n      no_question_paragraph.remove(); //We have just added a question so remove the no question text\r\n    } else {\r\n      let take_quiz_button = document.querySelector(\"#take_quiz_button\");\r\n      take_quiz_button.remove();\r\n    }\r\n  } else {\r\n    //Remove take quiz link if there are no questions\r\n    let take_quiz_button = document.querySelector(\"#take_quiz_button\");\r\n    take_quiz_button.remove();\r\n  }\r\n\r\n  Templates.renderForPromise(\"mod_livequiz/take_quiz_button\", contexttakequiz)\r\n    // It returns a promise that needs to be resoved.\r\n    .then(({ html, js }) => {\r\n      // Here we have compiled template.\r\n      Templates.appendNodeContents(\"#page_mod_livequiz_quizcreator\", html, js);\r\n      if (typeof callback === \"function\") {\r\n        callback();\r\n      }\r\n    })\r\n\r\n    // Deal with this exception (Using core/notify exception function is recommended).\r\n    .catch((error) => displayException(error));\r\n}\r\n\r\n/**\r\n * Sets up the event listener for the cancel button\r\n * @param {string} context - The context in which the cancel button is being used.\r\n */\r\nexport function add_cancel_edit_button_listener(context) {\r\n  let cancel_question_button = document.querySelector(\r\n      \".cancel_question_button\"\r\n  );\r\n  let modal_div = document.querySelector(\".modal_div\");\r\n  let stringForConfirm = \"\";\r\n\r\n  // Set the string for the confirm box based on the context.\r\n  switch (context) {\r\n    case \"create\":\r\n      stringForConfirm = \"Are you sure you want to cancel creating the question?\";\r\n      break;\r\n    case \"edit\":\r\n      stringForConfirm = \"Are you sure you want to cancel editing the question?\";\r\n      break;\r\n    case \"import\":\r\n      stringForConfirm = \"Are you sure you want to cancel importing the question?\";\r\n      break;\r\n    default:\r\n      stringForConfirm = \"Are you sure you want to cancel the changes made?\";\r\n  }\r\n  cancel_question_button.addEventListener(\"click\", () => {\r\n    if(confirm(stringForConfirm)) {\r\n      isEditing = false;\r\n      editingIndex = null;\r\n      modal_div.remove();\r\n    }\r\n    else {\r\n      return;\r\n    }\r\n  });\r\n}\r\n\r\n\r\n/**\r\n * This validates that all inputs to create/edit question, if not all inputs are satisfied, it will return false.\r\n * @param answers The answers of the question.\r\n * @returns {boolean} True if input fields are satisfied, false otherwise.\r\n */\r\nexport function validate_submission(answers) {\r\n  let isValid = true; // Is the question valid.\r\n  let answersValid = true; // Are all the answers valid.\r\n  let questionTitle = document.getElementById(\"question_title_id\").value.trim();\r\n  let questionTitleTextarea = document.getElementById(\"question_title_id\");\r\n  let questionTitleAlert = document.getElementById(\"title_textarea_alert\");\r\n  let questionDesription = document.getElementById(\"question_description_id\").value.trim();\r\n  let questionDesriptionTextarea = document.getElementById(\"question_description_id\");\r\n  let questionDescriptionAlert = document.getElementById(\"question_textarea_alert\");\r\n  let atLeastOneCorrectAnswerAlert = document.getElementById(\"question_alert_one_correct\");\r\n  let answerDescriptionAlert = document.getElementById(\"question_alert_description\");\r\n  let atLeastTwoAnswersAlert = document.getElementById(\"question_alert_two_answers\");\r\n  let maxOneCorrectAnswerAlert = document.getElementById(\"question_alert_max_one_correct\");\r\n  let questionType = document.getElementById(\"question_type_checkbox_id\").checked;\r\n  let answersBox = document.getElementById(\"all_answers\");\r\n  let isValidText = document.getElementById(\"valid_text\");\r\n\r\n  // Function to set the border style of an element.\r\n  const setBorderStyle = (element, isValid) => {\r\n    element.style.border = isValid ? \"1px solid #ccc\" : \"1px solid red\";\r\n  };\r\n\r\n  // Checks if the question title is empty.\r\n  if (!questionTitle) {\r\n    setBorderStyle(questionTitleTextarea, !!questionTitle);\r\n    questionTitleAlert.style.display = \"block\";\r\n    isValid = false;\r\n  } else {\r\n    questionTitleAlert.style.display = \"none\";\r\n    setBorderStyle(questionTitleTextarea, true);\r\n  }\r\n\r\n    // Checks if the question description is empty.\r\n  if (!questionDesription) {\r\n    setBorderStyle(questionDesriptionTextarea, !!questionDesription);\r\n    questionDescriptionAlert.style.display = \"block\";\r\n    isValid = false;\r\n  } else {\r\n    questionDescriptionAlert.style.display = \"none\";\r\n    setBorderStyle(questionDesriptionTextarea, true);\r\n  }\r\n\r\n  // Checks if there are at least two answers.\r\n  if (answers.length < 2) {\r\n    isValid = false;\r\n    answersValid = false;\r\n    atLeastTwoAnswersAlert.style.display = \"block\";\r\n  }\r\n  else {\r\n    atLeastTwoAnswersAlert.style.display = \"none\";\r\n  }\r\n\r\n  // Checks if at least one answer is correct.\r\n  if (!answers.some(answer => answer.correct === 1)) {\r\n    isValid = false;\r\n    answersValid = false;\r\n    atLeastOneCorrectAnswerAlert.style.display = \"block\";\r\n  }\r\n  else {\r\n    atLeastOneCorrectAnswerAlert.style.display = \"none\";\r\n  }\r\n\r\n  // Checks if all answers have a description.\r\n  if (answers.some(answer => !answer.description.trim())) {\r\n    isValid = false;\r\n    answersValid = false;\r\n    answerDescriptionAlert.style.display = \"block\";\r\n  } else {\r\n    answerDescriptionAlert.style.display = \"none\";\r\n  }\r\n\r\n  // Checks if multiple correct answers have been set, when not allowed to.\r\n  if (questionType) {\r\n    let checkedAnswers = 0;\r\n    answers.forEach(answer => {\r\n      checkedAnswers += answer.correct;\r\n    });\r\n    if (checkedAnswers > 1){\r\n      isValid = false;\r\n      answersValid = false;\r\n      maxOneCorrectAnswerAlert.style.display = \"block\";\r\n    } else {\r\n      maxOneCorrectAnswerAlert.style.display = \"none\";\r\n    }\r\n  } else {\r\n    maxOneCorrectAnswerAlert.style.display = \"none\";\r\n  }\r\n\r\n  if (!answersValid) { // If not all answers are valid show the box with warnings.\r\n    answersBox.style.display = \"block\";\r\n  } else {\r\n    answersBox.style.display = \"none\";\r\n  }\r\n\r\n  if (!isValid) { // If the question is not valid show warning.\r\n    isValidText.style.display = \"block\";\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n"],"names":["context","cancel_question_button","document","querySelector","modal_div","stringForConfirm","addEventListener","confirm","isEditing","editingIndex","remove","questions","callback","contextsavedquestions","renderForPromise","then","_ref","html","js","appendNodeContents","catch","error","console","log","url","hasquestions","contexttakequiz","no_question_paragraph","_ref2","answers","isValid","answersValid","questionTitle","getElementById","value","trim","questionTitleTextarea","questionTitleAlert","questionDesription","questionDesriptionTextarea","questionDescriptionAlert","atLeastOneCorrectAnswerAlert","answerDescriptionAlert","atLeastTwoAnswersAlert","maxOneCorrectAnswerAlert","questionType","checked","answersBox","isValidText","setBorderStyle","element","style","border","display","length","some","answer","correct","description","checkedAnswers","forEach","IDs","append_answer_input","answer_container","create_answer_container","appendChild","id","createElement","className","answer_input","placeholder","setAttribute","answer_checkbox","delete_answer_button","element_name","type","class_name","content","textContent"],"mappings":"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"}