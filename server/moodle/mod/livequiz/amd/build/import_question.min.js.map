{"version":3,"file":"import_question.min.js","sources":["../src/import_question.js"],"sourcesContent":["import Templates from \"core/templates\";\nimport {add_cancel_edit_button_listener, rerender_saved_questions_list} from \"./edit_question_helper\";\nimport {add_edit_question_listeners} from \"./edit_question\";\nimport {add_delete_question_listeners} from \"./delete_question\";\nimport {displayException} from \"core/notification\";\nimport {external_reuse_questions, get_lecturer_quiz} from \"./repository\";\nimport {rerender_take_quiz_button} from \"./edit_question_helper\";\n\n/**\n * Adds an event listener to the \"Import Question\" button.\n * When the button is clicked, it renders the import question menu popup.\n *\n * @param {number} quizid - The ID of the quiz.\n * @param {number} lecturerid - The ID of the lecturer.\n * @param {string} url - The URL to the quiz attempt page.\n * @returns {Promise<void>} A promise that resolves when the initialization is complete.\n */\nexport const init = async (quizid, lecturerid, url) => {\n  let import_question_button = document.getElementById(\n    \"id_buttonimportquestion\"\n  );\n  import_question_button.addEventListener(\"click\", () => {\n    render_import_question_menu_popup(quizid, lecturerid, url);\n  });\n};\n\n/**\n * Renders the import question menu popup for a live quiz.\n *\n * This function loads and renders the import question menu popup template, appends it to the main container,\n * Sets up event listeners for importing questions and cancelling the import.\n *\n * @param {number} quizid - The ID of the quiz.\n * @param {number} lecturerid - The ID of the lecturer.\n * @param {string} url - The URL to the quiz attempt page.\n * @returns {void} - Nothing.\n */\nasync function render_import_question_menu_popup(quizid, lecturerid, url) {\n  // This will call the function to load and render our template.\n  if (!document.querySelector(\".Modal_div\")) {\n    Templates.renderForPromise(\"mod_livequiz/import_question_popup\")\n        // It returns a promise that needs to be resolved.\n        .then(async({html, js}) => {\n            // Here we have compiled template.\n            Templates.appendNodeContents(\".main-container\", html, js);\n            await importQuestions(quizid, url, lecturerid);\n            add_cancel_edit_button_listener(\"import\");\n            add_old_questions_to_popup(lecturerid, quizid);\n        })\n\n      // Deal with this exception (Using core/notify exception function is recommended).\n      .catch((error) => displayException(error));\n  }\n}\n\n/**\n * Adds old questions to the import question popup.\n * @param {number} lecturerid - The ID of the lecturer.\n * @param {number} quizid - The ID of the quiz.\n */\nfunction add_old_questions_to_popup(lecturerid, quizid) {\n    get_lecturer_quiz(lecturerid).then((oldquizzes) => {\n        oldquizzes = oldquizzes.filter(currentquiz => currentquiz.quizid !== quizid);\n        let oldQuizzesContainer = document.querySelector(\".oldQuizzes\");\n        if (oldquizzes.length === 0) {\n            let noQuestions = document.createElement(\"p\");\n            noQuestions.textContent = \"No questions available.\";\n            oldQuizzesContainer.appendChild(noQuestions);\n            return;\n        }\n        oldquizzes.forEach((quiz) => { // Loop through all quizzes.\n            if (quiz.questions.length > 0) {\n                let question_checkboxes = [];\n                let quiz_div = document.createElement('div');\n                //Create quiz checkbox.\n                let quiz_checkbox = document.createElement('input');\n                quiz_checkbox.type = \"checkbox\";\n                quiz_checkbox.value = quiz.quizid;\n                quiz_checkbox.id = quiz.quizid;\n                quiz_checkbox.style.marginRight = \"5px\"; // Add margin so the text is not too close to the checkbox.\n                quiz_checkbox.name = quiz.quiztitle;\n                // Create quiz Label.\n                let quiz_label = document.createElement('label');\n                quiz_label.htmlFor = `quiz_${quiz.quizid}`;\n                quiz_label.textContent = quiz.quiztitle;\n                quiz_label.style.fontWeight = \"bold\"; // Make the quiz title bold.\n                quiz_div.class = \"oldquiz\"; // Might be used for styling.\n\n                // Append the checkbox and label to the div.\n                quiz_div.appendChild(quiz_checkbox);\n                quiz_div.appendChild(quiz_label);\n                // Set the border style\n                quiz_div.style.border = \"2px solid black\";\n                // Create container for questions.\n                let questions_div = document.createElement(\"div\");\n                questions_div.style.marginBottom = \"20px\";\n                questions_div.style.marginLeft = \"20px\"; // Add margin to the left so the questions are indented.\n                questions_div.id = \"questionsdiv\";\n                // Loop through each question and add it to the container.\n                quiz.questions.forEach((question) => {\n                    //Create question checkbox.\n                    let question_div = document.createElement('div');\n                    let question_checkbox = document.createElement('input');\n                    question_checkbox.type = \"checkbox\";\n                    question_checkbox.value = `question_${question.questionid}`;\n                    question_checkbox.style.marginRight = \"5px\"; // Add margin so the text is not too close to the checkbox.\n                    question_checkbox.id = question.questionid;\n                    question_checkbox.name = question.questiontitle;\n                    question_checkboxes.push(question_checkbox);\n                    // Create question Label.\n                    let question_label = document.createElement('label');\n                    question_label.htmlFor = `question_${question.questionid}`;\n                    question_label.textContent = question.questiontitle;\n\n                    question_div.appendChild(question_checkbox);\n                    question_div.appendChild(question_label);\n                    questions_div.appendChild(question_div);\n                });\n                add_quiz_checkbox_listener(quiz_checkbox, question_checkboxes);\n                add_question_checkbox_listener(quiz_checkbox, question_checkboxes);\n                quiz_div.appendChild(questions_div);\n                oldQuizzesContainer.appendChild(quiz_div);\n            }\n        });\n    }).catch((error) => console.log(error));\n}\n\n/**\n * Imports questions into a quiz.\n *\n * @param {number} quizid - The ID of the quiz.\n * @param {string} url - The URL of the quiz page.\n * @param {number} lecturerid - The ID of the lecturer.\n * @returns {Promise<void>} A promise that resolves when the questions are imported.\n */\nasync function importQuestions(quizid, url, lecturerid) {\n  let quiz_url = url;\n  const importQuestionBtn = document.querySelector(\".import_btn\");\n\n    importQuestionBtn.addEventListener(\"click\", async() => {\n        try {\n            let questionids = get_checked_questions();\n            if (questionids.length === 0) {\n                alert(\"No questions selected. Pleas choose at least one question to import.\")\n                return;\n            }\n            call_reuse_questions(quizid, questionids, lecturerid, quiz_url);\n        } catch (error) {\n            window.console.error(\"Error in import of questions\");\n            console.log(error);\n        }\n    });\n}\n\n/**\n * Calls the external function to reuse questions.\n * @param {number} quizid - The ID of the quiz.\n * @param {array} questionids - The IDs of the questions to reuse.\n * @param {number} lecturerid - The ID of the lecturer.\n * @param {string} quiz_url - The URL of the quiz page.\n */\nfunction call_reuse_questions(quizid, questionids, lecturerid, quiz_url) {\n  external_reuse_questions(quizid, questionids, lecturerid)\n    .then((questions) => {\n      let update_event_listeners = () => {\n        add_edit_question_listeners(quizid, lecturerid);\n        add_delete_question_listeners(quizid, lecturerid);\n      };\n      rerender_saved_questions_list(questions, update_event_listeners); // Re-render saved questions list.\n      rerender_take_quiz_button(quiz_url, true); // Re-render take quiz button.\n    })\n    .catch((error) => console.log(error));\n  let modal_div = document.querySelector(\".backdrop\");\n  modal_div.remove();\n}\n\n/**\n * Retrieves the values of all checked questions from the lecturer's question list.\n *\n * @returns {Array<number>} An array containing the ids of the checked questions.\n */\nfunction get_checked_questions() {\n  let checkedquestions = [];\n  let questions_div = document.querySelector(\".oldQuizzes\");\n\n  // Loop through all quizzes and get the checked questions.\n  for (let quiz_div of questions_div.children) {\n    // Loop through all quizzes.\n    for (let content of quiz_div.children) {\n      // Loop through all content of the quiz.\n      if (content.tagName === \"DIV\") {\n        // Only look in div elements\n        for (let question_div of content.children) {\n          // Loop through all questions.\n          for (let children of question_div.children) {\n            // Loop through all children of the question.\n            if (children.tagName === \"INPUT\") {\n              // Only look in input elements.\n              let checkbox = children;\n              if (checkbox.checked) {\n                // If the checkbox is checked, add the id to the array.\n                checkedquestions.push(parseInt(checkbox.id));\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  return checkedquestions; // Returns the checked questions.\n}\n\n/**\n * Adds an event listener to the quiz checkboxes.\n * @param checkbox - The checkbox to add the event listener to.\n * @param questioncheckboxes - The question checkboxes that are manipulated when event is triggered.\n */\nfunction add_quiz_checkbox_listener(checkbox, questioncheckboxes) {\n  checkbox.addEventListener(\"change\", () => {\n    questioncheckboxes.forEach((questioncheckbox) => {\n      questioncheckbox.checked = checkbox.checked; // Set all questions to checked if the quiz is checked.\n    });\n  });\n}\n\n/**\n * Adds an event listener to the question checkboxes.\n * @param checkbox - The checkbox that is manipulated when all questions are checked.\n * @param questioncheckboxes - The question checkboxes to add the event listener to.\n */\nfunction add_question_checkbox_listener(checkbox, questioncheckboxes) {\n  questioncheckboxes.forEach((questioncheckbox) => {\n    questioncheckbox.addEventListener(\"change\", () => {\n      if (questioncheckbox.checked) {\n        // If the question is checked, check if all questions are checked.\n        let checkboxes_same = false;\n        checkboxes_same = check_questions_checked(questioncheckboxes);\n        if (checkboxes_same) {\n          // If all questions are checked, check the quiz checkbox.\n          checkbox.checked = questioncheckbox.checked;\n        }\n      } else {\n        // If the question is unchecked, uncheck the quiz checkbox.\n        checkbox.checked = questioncheckbox.checked;\n      }\n    });\n  });\n}\n\n/**\n * Checks if all questions are checked.\n * @param questions\n * @returns {bool} - True if all questions are checked, false otherwise.\n */\nfunction check_questions_checked(questions) {\n  return questions.every((question) => question.checked); // Returns true only if all are checked\n}\n"],"names":["async","quizid","lecturerid","url","document","getElementById","addEventListener","querySelector","renderForPromise","then","html","js","appendNodeContents","quiz_url","questionids","checkedquestions","questions_div","quiz_div","children","content","tagName","question_div","checkbox","checked","push","parseInt","id","get_checked_questions","length","alert","questions","update_event_listeners","catch","error","console","log","remove","call_reuse_questions","window","importQuestions","oldquizzes","filter","currentquiz","oldQuizzesContainer","noQuestions","createElement","textContent","appendChild","forEach","quiz","question_checkboxes","quiz_checkbox","type","value","style","marginRight","name","quiztitle","quiz_label","htmlFor","fontWeight","class","border","marginBottom","marginLeft","question","question_checkbox","questionid","questiontitle","question_label","questioncheckboxes","questioncheckbox","checkboxes_same","every","add_question_checkbox_listener","add_old_questions_to_popup","render_import_question_menu_popup"],"mappings":"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"}