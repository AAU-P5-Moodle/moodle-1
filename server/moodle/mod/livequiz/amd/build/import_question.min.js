define("mod_livequiz/import_question",["exports","core/templates","core/notification","./helper","./edit_question","./delete_question","./repository"],(function(_exports,_templates,_notification,_helper,_edit_question,_delete_question,_repository){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=async(quizId,lecturerId,url)=>{document.getElementById("import_question_button").addEventListener("click",(()=>{!function(quizId,lecturerId,url){document.querySelector(".modal_div")||_templates.default.renderForPromise("mod_livequiz/import_question_popup",{},"boost").then((_ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents(".main_container",html,js),async function(quizId,url,lecturerId){let quizUrl=url;document.querySelector(".import_question_button").addEventListener("click",(async()=>{try{let questionIds=function(){let checkedquestions=[];return document.querySelectorAll(".question_checkbox").forEach((question=>{question.checked&&checkedquestions.push(parseInt(question.id))})),checkedquestions}();if(0===questionIds.length)return void alert("No questions selected. Please choose at least one question to import.");!function(quizId,questionIds,lecturerId,quizUrl){(0,_repository.externalReuseQuestions)(quizId,questionIds,lecturerId).then((questions=>{let updateEventListeners=()=>{(0,_edit_question.addEditQuestionListeners)(quizId,lecturerId),(0,_delete_question.addDeleteQuestionListeners)(quizId,lecturerId)};(0,_helper.rerenderSavedQuestionsList)(questions,updateEventListeners),(0,_helper.rerenderTakeQuizButton)(quizUrl,!0)})).catch((error=>(0,_notification.exception)(error))),document.querySelector(".backdrop").remove()}(quizId,questionIds,lecturerId,quizUrl)}catch(error){(0,_notification.exception)(error)}}))}(quizId,url,lecturerId),(0,_helper.addCancelEditButtonListener)("import"),function(lecturerId,quizId){(0,_repository.getLecturerQuiz)(lecturerId).then((oldQuizzes=>{oldQuizzes=oldQuizzes.filter((currentquiz=>currentquiz.quizid!==quizId));let oldQuizzesContainer=document.querySelector(".old_quizzes");if(0===oldQuizzes.length){let noQuestions=document.createElement("p");return noQuestions.textContent="No questions available.",void oldQuizzesContainer.appendChild(noQuestions)}oldQuizzes.forEach((quiz=>{let quiz_context={quizid:quiz.quizid,quiztitle:quiz.quiztitle,questions:quiz.questions};quiz.questions.length>0&&_templates.default.renderForPromise("mod_livequiz/import_questions_list",quiz_context).then((_ref2=>{let{html:html,js:js}=_ref2;_templates.default.appendNodeContents(".old_quizzes",html,js),function(quizId){let quizCheckbox=document.querySelector(".quiz_"+quizId),questionCheckboxes=document.querySelectorAll(".quiz_"+quizId+"_question");quizCheckbox.addEventListener("change",(()=>{questionCheckboxes.forEach((questionCheckbox=>{if(questionCheckbox.checked=quizCheckbox.checked,questionCheckbox.checked){questionCheckbox.parentElement.classList.add("question_selected")}else{questionCheckbox.parentElement.classList.remove("question_selected")}}))}))}(quiz.quizid),function(quizId){let quizCheckbox=document.querySelector(".quiz_"+quizId),questionCheckboxes=document.querySelectorAll(".quiz_"+quizId+"_question");questionCheckboxes.forEach((questionCheckbox=>{questionCheckbox.addEventListener("click",(event=>{questionCheckbox.checked=!questionCheckbox.checked})),questionCheckbox.addEventListener("change",(()=>{let questionEntry=questionCheckbox.parentElement;if(questionCheckbox.checked){questionEntry.classList.add("question_selected");let allChecked=!1;questions=questionCheckboxes,allChecked=Array.from(questions).every((question=>question.checked)),allChecked&&(quizCheckbox.checked=!0)}else questionEntry.classList.remove("question_selected"),quizCheckbox.checked=!1;var questions}))}))}(quiz.quizid),function(quizId){document.querySelectorAll(".question_entry_"+quizId).forEach((questionEntry=>{questionEntry.addEventListener("click",(()=>{let questionCheckbox=questionEntry.querySelector(".question_checkbox");questionCheckbox.checked=!questionCheckbox.checked,questionCheckbox.dispatchEvent(new Event("change"))}))}))}(quiz.quizid)})).catch((error=>(0,_notification.exception)(error)))}))})).catch((error=>(0,_notification.exception)(error)))}(lecturerId,quizId)})).catch((error=>(0,_notification.exception)(error)))}(quizId,lecturerId,url)}))}}));

//# sourceMappingURL=import_question.min.js.map