{"version":3,"file":"create_question.min.js","sources":["../src/create_question.js"],"sourcesContent":["import Templates from \"core/templates\";\r\nimport {saveQuestion} from \"./repository\";\r\nimport {addDeleteQuestionListeners} from \"./delete_question\";\r\nimport {addEditQuestionListeners} from \"./edit_question\";\r\nimport {\r\n    addAnswerButtonEventListener,\r\n    addCancelEditButtonListener,\r\n    rerenderSavedQuestionsList,\r\n    rerenderTakeQuizButton,\r\n    validateSubmission,\r\n    getQuestionData,\r\n    prepareAnswers,\r\n} from \"./helper\";\r\n\r\nlet takeQuizUrl = \"\";\r\n\r\n/**\r\n * Adds an event listener to the \"Add Question\" button.\r\n * When the button is clicked, it renders the create question menu popup.\r\n *\r\n * @param {number} quizId - The ID of the quiz.\r\n * @param {number} lecturerId - The ID of the lecturer.\r\n * @param {string} url - The URL to the quiz attempt page.\r\n * @returns {Promise<void>} A promise that resolves when the initialization is complete.\r\n */\r\nexport const init = async(quizId, lecturerId, url) => {\r\n    takeQuizUrl = url; // Set url to quiz attempt page to global variable.\r\n    let addQuestionButton = document.getElementById(\"add_question_button\");\r\n    addQuestionButton.addEventListener(\"click\", () => {\r\n        renderCreateQuestionMenuPopup(quizId, lecturerId);\r\n    });\r\n};\r\n\r\n/**\r\n * Renders the create question menu popup for a live quiz.\r\n *\r\n * This function loads and renders the question menu popup template, appends it to the main container,\r\n * Sets up event listeners for adding answers, saving the question, and discarding the question.\r\n *\r\n * @param {number} quizId - The ID of the quiz.\r\n * @param {number} lecturerId - The ID of the lecturer.\r\n * @returns {void}\r\n */\r\nfunction renderCreateQuestionMenuPopup(quizId, lecturerId) {\r\n    // This will call the function to load and render our template.\r\n    if (!document.querySelector('.Modal_div')) {\r\n        Templates.renderForPromise(\"mod_livequiz/question_menu_popup\", {}, \"boost\")\r\n\r\n      // It returns a promise that needs to be resolved.\r\n        .then(({html, js}) => {\r\n          // Here we have compiled template.\r\n            Templates.appendNodeContents(\".main_container\", html, js);\r\n            addAnswerButtonEventListener();\r\n            addSaveQuestionButtonListener(quizId, lecturerId);\r\n            addCancelEditButtonListener(\"create\");\r\n        })\r\n        .catch((error) => alert(error));\r\n    }\r\n}\r\n\r\n/**\r\n * Adds an event listener to the save question button\r\n *\r\n * @param {number} quizId - The ID of the quiz.\r\n * @param {number} lecturerId - The ID of the lecturer.\r\n * @return {void}\r\n */\r\nfunction addSaveQuestionButtonListener(quizId, lecturerId) {\r\n    let saveQuestionButton = document.querySelector(\".save_button\");\r\n    saveQuestionButton.addEventListener(\"click\", () => {\r\n        handleQuestionSubmission(quizId, lecturerId);\r\n    });\r\n}\r\n\r\n/**\r\n * Event handler for when a question is saved.\r\n * @param {int} quizId\r\n * @param {int} lecturerId\r\n * @returns {void}\r\n */\r\nfunction handleQuestionSubmission(quizId, lecturerId) {\r\n    let savedQuestion = prepareQuestion(); // Prepare the question object to be sent to DB.\r\n\r\n    if (!validateSubmission(savedQuestion.answers)) {\r\n        return;\r\n    }\r\n\r\n    let updateEventListeners = () => {\r\n        addEditQuestionListeners(quizId, lecturerId);\r\n        addDeleteQuestionListeners(quizId, lecturerId);\r\n    };\r\n\r\n    saveQuestion(savedQuestion, lecturerId, quizId).then((questions) => {\r\n        rerenderSavedQuestionsList(questions, updateEventListeners); // Re-render saved questions list.\r\n        rerenderTakeQuizButton(takeQuizUrl, true); // Re-render take quiz button.\r\n    })\r\n    .catch((error) => window.console.log(error));\r\n\r\n    let modalDiv = document.querySelector(\".backdrop\");\r\n    modalDiv.remove();\r\n}\r\n\r\n/**\r\n * Gets the data for a question inputted in the UI. Used when creating or editing a question.\r\n *\r\n * @returns {{answers: Array, description: *, id: number, title: *, explanation: *, type: number}}\r\n */\r\nfunction prepareQuestion() {\r\n    let questionData = getQuestionData();\r\n\r\n    return {\r\n        id: 0,\r\n        title: questionData.title,\r\n        answers: prepareAnswers(),\r\n        description: questionData.description,\r\n        explanation: questionData.explanation,\r\n        type: questionData.type,\r\n    };\r\n}\r\n"],"names":["takeQuizUrl","async","quizId","lecturerId","url","document","getElementById","addEventListener","querySelector","renderForPromise","then","_ref","html","js","appendNodeContents","savedQuestion","questionData","id","title","answers","description","explanation","type","prepareQuestion","updateEventListeners","questions","catch","error","window","console","log","remove","handleQuestionSubmission","addSaveQuestionButtonListener","alert","renderCreateQuestionMenuPopup"],"mappings":"6WAcIA,YAAc,iBAWEC,MAAMC,OAAQC,WAAYC,OAC1CJ,YAAcI,IACUC,SAASC,eAAe,uBAC9BC,iBAAiB,SAAS,eAeTL,OAAQC,YAEtCE,SAASG,cAAc,kCACdC,iBAAiB,mCAAoC,GAAI,SAGlEC,MAAKC,WAACC,KAACA,KAADC,GAAOA,4BAEAC,mBAAmB,kBAAmBF,KAAMC,wDAgB3BX,OAAQC,YAClBE,SAASG,cAAc,gBAC7BD,iBAAiB,SAAS,eAWfL,OAAQC,gBAClCY,6BA2BAC,cAAe,mCAEZ,CACHC,GAAI,EACJC,MAAOF,aAAaE,MACpBC,SAAS,4BACTC,YAAaJ,aAAaI,YAC1BC,YAAaL,aAAaK,YAC1BC,KAAMN,aAAaM,MAnCHC,QAEf,8BAAmBR,cAAcI,oBAIlCK,qBAAuB,iDACEtB,OAAQC,4DACND,OAAQC,0CAG1BY,cAAeZ,WAAYD,QAAQQ,MAAMe,mDACvBA,UAAWD,yDACfxB,aAAa,MAEvC0B,OAAOC,OAAUC,OAAOC,QAAQC,IAAIH,SAEtBtB,SAASG,cAAc,aAC7BuB,SA7BLC,CAAyB9B,OAAQC,eAjB7B8B,CAA8B/B,OAAQC,oDACV,aAE/BuB,OAAOC,OAAUO,MAAMP,SA3BxBQ,CAA8BjC,OAAQC"}