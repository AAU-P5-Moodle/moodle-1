{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template mod_livequiz/take_livequiz_page

    Index Page for the livequiz plugin

    Classes required for JS:
    * none

    Context variables required for this template:
    * fill in later

    Example context (json):
    * fill in later

}}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Select all answer options (radio buttons, checkboxes, and dropdowns)
        const answerOptions = document.getElementsByClassName("{{quizid}}");

        //console.log(answerOptions);
        // Add a 'change' event listener to each option
        answerOptions.forEach(option => {
            option.addEventListener("change", function(event) {
                // Get all selected answers
                const selectedAnswers = [];
                Array.from(answerOptions).forEach(input => {
                    if (input.checked || input.type === 'radio' && input.checked || input.type === 'checkbox' && input.checked) {
                        selectedAnswers.push(input.value);
                    }
                });
                //KEPT FOR DEVELOPMENT
                //console.log(selectedAnswers);

                // Update session
                const xhr = new XMLHttpRequest();
                xhr.open("POST", "update_session.php", true);
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                //KEPT FOR DEVELOPMENT
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        console.log("Session updated successfully");
                    }
                };
                // JSON stringify is decoded in update_session.php
                xhr.send(`questionid={{questionid}}&answervalue=${JSON.stringify(selectedAnswers)}`);

            });
        });

    })
</script>
<div class="main-container">
  {{> mod_livequiz/question_section}} {{! question_section import - Context remains the same}}
  {{> mod_livequiz/nav_bar_section}} {{! nav_bar section import - Context remains the same}}
  {{> mod_livequiz/side_bar_section}} {{! side_bar section import - Context remains the same}}
</div>


