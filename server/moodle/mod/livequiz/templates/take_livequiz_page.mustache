{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template mod_livquiz/take_livequiz_page

    Index Page for the livequiz plugin

    Classes required for JS:
    * none

    Context variables required for this template:
    * fill in later

    Example context (json):
    * fill in later

}}

<div class="main-container">
    <form method="post" action="attempt.php" id="{{quizid}}">
  <div class="title-container">
    <h1 class="quiz-title">{{quiztitle}}</h1>
  </div>
  <div class="question-container">
      <p class="question-title">{{questiontitle}}</p>
      <div class="media-container">
          <img src="" alt="">
      </div>
    <p class="question-description">{{description}}</p>
  </div>
  <div class="answer-container">
  <fieldset>
  {{#answers}}
    <div class="answer">
      <label for="{{answerid}}">{{answer_description}}</label>
      <input class="{{quizid}}" type="{{answertype}}" id="{{answerid}}" name="answers_for_question_{{questionid}}[]" value="{{answerid}}"/>
    </div>
  {{/answers}}
  </fieldset>
  </div>
        <input type="hidden" name="cmid" value="{{cmid}}" />
        <input type="hidden" name="quizid" value="{{quizid}}" />
        <input type="hidden" name="questionid" value="{{questionid}}" />
        <input type="hidden" name="questiontitle" value="{{questiontitle}}" />
        <input type="hidden" name="numberofquestions" value="{{numberofquestions}}" />
        <input type="hidden" name="nextquestionid" value="{{nextquestionid}}" />
        <input type="submit" value="Submit question" id="submitQuestion">

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                console.log("loaded DOM content")
                // Select all answer options (radio buttons, checkboxes, and dropdowns)
                const answerOptions = document.getElementsByClassName("{{quizid}}");

                console.log(answerOptions);
                // Add a 'change' event listener to each option
                answerOptions.forEach(option => {
                    option.addEventListener("change", function(event) {
                        const changedElement = event.target;
                        console.log(`Changed answer on ${changedElement.name} to value: ${changedElement.value}`);

                        // Get all selected answers
                        const selectedAnswers = [];
                        Array.from(answerOptions).forEach(input => {
                            if (input.checked || input.type === 'radio' && input.checked || input.type === 'checkbox' && input.checked) {
                                selectedAnswers.push(input.value);
                            }
                        });
                        console.log(selectedAnswers);

                        // Update session
                        const xhr = new XMLHttpRequest();
                        xhr.open("POST", "update_session.php", true);
                        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                        xhr.onreadystatechange = function () {
                            if (xhr.readyState === 4 && xhr.status === 200) {
                                console.log("Session updated successfully");
                            }
                        };
                        console.log("json string" + JSON.stringify(selectedAnswers))
                        xhr.send(`questionid={{questionid}}&answerid={{answerid}}&answervalue=${JSON.stringify(selectedAnswers)}`);

                    });
                });

        })
        </script>
    </form>
  <button class="check-answer">Check answer</button>
  <div class="question-navigation">
      <a href="{{previousurl}}" type="button" id="previousButton"> Previous Question </a>
      <a href="{{nexturl}}" type="button" id="nextButton"> Next Question </a>
  </div>
    <div class="navbar">
        <button class="submit-quiz" onclick="location.href='{{resultsurl}}'">Submit Quiz</button>
    </div>
</div>

